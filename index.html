<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LearnPac Online Training Services</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="icon" type="image/x-icon" href="./assets/images/lplogo.png">
  <link rel="stylesheet" href="style/index.css">

  <!-- NProgress -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
  <div class="container">
    <a class="navbar-brand" href="#">
      <img src="./assets/images/lplogo.png" alt="Logo" width="150">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
        <li class="nav-item"><a class="nav-link" href="?content=Home">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="?content=About">About Us</a></li>
        <li class="nav-item"><a class="nav-link" href="?content=Services">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="?content=Courses">Courses</a></li>
        <li class="nav-item"><a class="nav-link" href="?content=Contacts">Contact</a></li>
        <li class="nav-item">
          <form class="d-flex align-items-center position-relative search-form" id="navbar-search-form" autocomplete="off">
            <div class="search-container">
              <input type="text" class="form-control search-input" placeholder="Search courses..." aria-label="Search" id="search-input">
              <button type="submit" class="btn btn-link search-btn">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </form>
        </li>
        <li class="nav-item">
          <a class="btn btn-outline-primary me-2 login-btn" href="https://app.learnpac.co.uk/log-in/" target="_blank">
            <i class="fas fa-user me-1"></i>Login
          </a>
        </li>
        <li class="nav-item position-relative">
          <button class="btn btn-link position-relative cart-btn">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count">0</span>
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div id="main">Loading...</div>

<script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>
<script>
  // Start NProgress on page load
  document.addEventListener('DOMContentLoaded', () => {
    NProgress.start();
  });

  window.addEventListener('load', () => {
    NProgress.done();
  });

  // Handle search form submission
  document.getElementById('navbar-search-form').addEventListener('submit', function(e) {
    e.preventDefault(); // Prevent form submission
    const searchTerm = document.getElementById('search-input').value;
    if (searchTerm.trim()) {
      // Navigate to courses page with search term
      history.pushState({ content: 'Courses' }, '', '?content=Courses');
      loadContent('Courses', searchTerm);
    }
  });

  // Load content by name with NProgress
  function loadContent(content, searchTerm = '') {
    NProgress.start(); // Show loading progress
    const pageMap = {
      Home: "./html/home.html",
      About: "./html/about-us.html",
      Contact: "pages/contact.html",
      Services: "./html/services.html",
      Courses: "./html/courses.html",
      Contacts: "./html/contact.html"
    };

    const page = pageMap[content] || null;

    if (page) {
      fetch(page)
        .then(res => res.ok ? res.text() : Promise.reject("Page not found"))
        .then(html => {
          const main = document.getElementById("main");
          main.innerHTML = html;

          // Re-execute any scripts inside the loaded HTML
          main.querySelectorAll("script").forEach(oldScript => {
            const newScript = document.createElement("script");
            if (oldScript.src) {
              newScript.src = oldScript.src;
            } else {
              newScript.textContent = oldScript.textContent;
            }
            document.body.appendChild(newScript);
            oldScript.remove();
          });

          // Call page-specific initializer if defined
          if (content === 'Courses' && typeof window.initializeCourses === 'function') {
            window.initializeCourses(searchTerm);
          }

          // Update nav link active state
          document.querySelectorAll('.nav-link').forEach(link => {
            const href = link.getAttribute('href');
            if (href && href.startsWith('?content=')) {
              const linkContent = new URLSearchParams(href.split('?')[1]).get("content");
              link.classList.toggle('active', linkContent === content);
            }
          });
        })
        .catch(err => {
          document.getElementById("main").innerHTML = "<h1>404 - Page Not Found</h1>";
          console.error(err);
        })
        .finally(() => {
          NProgress.done(); // Hide loading progress once content is loaded
        });
    } else {
      document.getElementById("main").innerHTML = "<h1>404 - Page Not Found</h1>";
      NProgress.done();
    }
  }

  // Intercept nav clicks and manage history
  document.addEventListener('DOMContentLoaded', () => {
    const initialContent = new URLSearchParams(window.location.search).get("content") || "Home";
    loadContent(initialContent);

    document.querySelectorAll('a.nav-link').forEach(link => {
      link.addEventListener('click', function (e) {
        const href = this.getAttribute('href');
        if (href && href.startsWith('?content=')) {
          e.preventDefault();
          const content = new URLSearchParams(href.split('?')[1]).get("content");
          history.pushState({ content }, '', href);
          loadContent(content);
        }
      });
    });
  });

  window.addEventListener('popstate', event => {
    const content = (event.state && event.state.content) || new URLSearchParams(window.location.search).get("content") || "Home";
    loadContent(content);
  });
</script>


<!-- Footer -->
<footer class="footer-dark py-5">
  <div class="container">
    <div class="row justify-content-between align-items-center mb-5">
      <div class="col-md-6">
        <h2 class="fw-bold text-white">Ready to Transform Your Learning Experience?</h2>
        <p class="text-white-50">Join thousands of organizations already using LearnPac</p>
      </div>
      <div class="col-md-6 text-md-end mt-3 mt-md-0">
        <a href="#" class="btn btn-brand me-2">Get Started</a>
        <a href="#" class="btn btn-outline-light">Contact Sales</a>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-lg-4 col-md-6">
        <img src="./assets/images/lplogo.png" alt="LearnPac Logo" class="mb-3" width="150">
        <p class="text-white-50 mb-3">Empowering organizations with accredited online training solutions and professional qualifications.</p>
        <div class="social-icons d-flex gap-3 mb-3">
          <a href="#" class="text-white"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="text-white"><i class="fab fa-x-twitter"></i></a>
          <a href="#" class="text-white"><i class="fab fa-instagram"></i></a>
          <a href="#" class="text-white"><i class="fab fa-linkedin-in"></i></a>
        </div>
        <form class="d-flex newsletter-form">
          <input type="email" class="form-control" placeholder="Enter your email">
          <button class="btn btn-brand ms-2">Subscribe</button>
        </form>
      </div>
      <div class="col-lg-2 col-md-6">
        <h6 class="text-white mb-3">Company</h6>
        <ul class="list-unstyled footer-links">
          <li><a href="./html/about-us.html">About Us</a></li>
          <li><a href="./html/Services.php">Services</a></li>
          <li><a href="#courses">Courses</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-md-6">
        <h6 class="text-white mb-3">Resources</h6>
        <ul class="list-unstyled footer-links">
          <li><a href="#">Blog</a></li>
          <li><a href="#">Support</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-md-6">
        <h6 class="text-white mb-3">Legal</h6>
        <ul class="list-unstyled footer-links">
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Terms of Service</a></li>
          <li><a href="#">Accessibility</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-md-6">
        <h6 class="text-white mb-3">Contact</h6>
        <ul class="list-unstyled footer-links">
          <li><a href="tel:+44123456789">+44 123 456 789</a></li>
          <li><a href="mailto:info@learnpac.co.uk">test@learnpac.co.uk</a></li>
          <li class="text-white-50">123 Business Street<br>London, UK<br>SW1A 1AA</li>
        </ul>
      </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-5 border-top border-secondary pt-4">
      <div class="text-white-50">
        &copy; 2024 LearnPac. All rights reserved.
      </div>
      <div class="d-flex gap-3">
        <a href="#" class="text-white-50 text-decoration-none">Privacy</a>
        <a href="#" class="text-white-50 text-decoration-none">Terms</a>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- AI Chat Widget -->
<div class="chat-widget minimized" id="chatWidget">
  <div class="chat-minimized" onclick="toggleChat()">
    <i class="fas fa-robot"></i>
    <span class="notification-badge">1</span>
  </div>
  <div class="chat-expanded">
    <div class="chat-header">
      <div class="d-flex align-items-center">
        <i class="fas fa-robot me-2"></i>
        <span>AI Assistant</span>
      </div>
      <button class="btn-close btn-close-white" onclick="toggleChat()"></button>
    </div>
    <div class="chat-body" id="chatBody">
      <div class="chat-messages" id="chatMessages">
        <div class="message bot">
          <div class="message-content">
            Hi there! I'm LP, your AI assistant. How can I help you today?
          </div>
        </div>
      </div>
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Type your message..." onkeypress="handleChatInput(event)">
        <button onclick="sendMessage()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
/* Header and Navbar Styles */
.navbar {
  padding: 0.8rem 0;
  transition: all 0.3s ease;
}

.navbar-brand img {
  transition: transform 0.3s ease;
}

.navbar-brand:hover img {
  transform: scale(1.05);
}

.nav-link {
  font-weight: 500;
  padding: 0.5rem 1rem !important;
  color: #333 !important;
  transition: color 0.3s ease;
}

.nav-link:hover {
  color: #007bff !important;
}

.nav-link.active {
  color: #007bff !important;
}

/* Search Form Styles */
.search-form {
  margin: 0 1rem;
  width: 250px;
}

.search-container {
  position: relative;
  width: 100%;
}

.search-input {
  border-radius: 25px;
  padding: 0.6rem 1rem 0.6rem 2.5rem;
  border: 1px solid #e0e0e0;
  background: #f8f9fa;
  font-size: 0.95rem;
  width: 100%;
}

.search-input:focus {
  background: #fff;
  border-color: #007bff;
  box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.15);
  outline: none;
}

.search-btn {
  position: absolute;
  left: 0.8rem;
  top: 50%;
  transform: translateY(-50%);
  color: #6c757d;
  padding: 0;
  font-size: 0.9rem;
  background: none;
  border: none;
}

.search-btn:hover {
  color: #007bff;
}

/* Search Results Dropdown */
.search-results-dropdown {
  position: absolute;
  top: calc(100% + 0.5rem);
  left: 0;
  right: 0;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  margin-top: 0.5rem;
  z-index: 1000;
  max-height: 400px;
  overflow-y: auto;
  border: 1px solid #e0e0e0;
}

.search-results-content {
  padding: 0.5rem;
}

.search-result-item {
  display: flex;
  align-items: center;
  padding: 0.8rem;
  border-radius: 8px;
  transition: background-color 0.2s ease;
  cursor: pointer;
}

.search-result-item:hover {
  background-color: #f8f9fa;
}

.search-result-item img {
  width: 45px;
  height: 45px;
  object-fit: cover;
  border-radius: 6px;
  margin-right: 1rem;
}

.search-result-item .course-info {
  flex-grow: 1;
}

.search-result-item .course-title {
  font-weight: 500;
  margin-bottom: 0.2rem;
  color: #333;
  font-size: 0.95rem;
}

.search-result-item .course-price {
  color: #28a745;
  font-weight: 500;
  font-size: 0.9rem;
}

.search-result-item .add-to-cart-btn {
  padding: 0.5rem 1rem;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.search-result-item .add-to-cart-btn:hover {
  background: #0056b3;
  transform: translateY(-1px);
}

/* Login Button */
.login-btn {
  padding: 0.5rem 1.2rem;
  border-radius: 25px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.login-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,123,255,0.15);
}

/* Cart Button */
.cart-btn {
  color: #333;
  padding: 0.5rem;
  font-size: 1.2rem;
  transition: all 0.3s ease;
}

.cart-btn:hover {
  color: #007bff;
  transform: translateY(-1px);
}

.cart-count {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #dc3545;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 500;
}

/* Loading Animation */
.search-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  color: #666;
  font-size: 0.9rem;
}

.search-loading::after {
  content: '';
  width: 16px;
  height: 16px;
  border: 2px solid #007bff;
  border-top-color: transparent;
  border-radius: 50%;
  margin-left: 0.5rem;
  animation: spin 0.8s linear infinite;
}

/* No Results Styling */
.no-results {
  text-align: center;
  padding: 1.5rem;
  color: #666;
}

.no-results i {
  font-size: 2rem;
  color: #ddd;
  margin-bottom: 0.5rem;
}

.no-results p {
  margin: 0;
  font-size: 0.9rem;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* Responsive Adjustments */
@media (max-width: 991.98px) {
  .search-form {
    margin: 1rem 0;
    width: 250px;
  }
  
  .navbar-nav {
    padding: 1rem 0;
  }
  
  .nav-link {
    padding: 0.5rem 0 !important;
  }
  
  .login-btn {
    margin: 0.5rem 0;
    width: 100%;
    text-align: center;
  }
}
</style>

<script>
function toggleChat() {
  const widget = document.getElementById('chatWidget');
  widget.classList.toggle('minimized');
  
  // Remove notification badge when chat is opened
  if (!widget.classList.contains('minimized')) {
    const badge = document.querySelector('.notification-badge');
    if (badge) {
      badge.style.display = 'none';
    }
  }
}

function handleChatInput(event) {
  if (event.key === 'Enter') {
    sendMessage();
  }
}

function sendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (message) {
    addMessage(message, 'user');
    input.value = '';
    
    // Simulate AI response after a short delay
    setTimeout(() => {
      const responses = [
        "Hi! LP here. I'd be happy to help you with our courses.",
        "As LP, I can guide you through our training programs.",
        "LP at your service! Let me help you find the perfect course.",
        "That's a great question! LP here to assist you with that.",
        "Need help? LP is here to provide all the information you need."
      ];
      const randomResponse = responses[Math.floor(Math.random() * responses.length)];
      addMessage(randomResponse, 'bot');
    }, 1000);
  }
}

function addMessage(text, type) {
  const messages = document.getElementById('chatMessages');
  const messageDiv = document.createElement('div');
  messageDiv.className = `message ${type}`;
  messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
  messages.appendChild(messageDiv);
  messages.scrollTop = messages.scrollHeight;
}

// Add cart functionality
let cart = [];

// Load cart from server
async function loadCart() {
    try {
        const response = await fetch('data/cart_operations.php?action=get_cart');
        const data = await response.json();
        
        if (data.success) {
            cart = data.cart;
            updateCartCount();
            displayCart();
        }
    } catch (error) {
        console.error('Error loading cart:', error);
    }
}

// Display cart items
function displayCart() {
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    
    if (!cartItems || !cartTotal) return;
    
    if (cart.length === 0) {
        cartItems.innerHTML = `
            <div class="empty-cart">
                <i class="fas fa-shopping-cart"></i>
                <p>Your cart is empty</p>
            </div>
        `;
        cartTotal.textContent = '0.00';
        return;
    }

    let total = 0;
    cartItems.innerHTML = '';

    cart.forEach(item => {
        total += item.price;
        cartItems.innerHTML += `
            <div class="cart-item">
                <img src="${item.image}" alt="${item.title}" onerror="this.src='https://placehold.co/50x50?text=${encodeURIComponent(item.title)}'">
                <div class="cart-item-info">
                    <div class="cart-item-title">${item.title}</div>
                    <div class="cart-item-price">£${item.price.toFixed(2)}</div>
                </div>
                <button class="cart-item-remove" onclick="removeFromCart(${item.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
    });

    cartTotal.textContent = total.toFixed(2);
}

// Remove from cart
async function removeFromCart(courseId) {
    try {
        const response = await fetch(`data/cart_operations.php?action=remove_from_cart&courseId=${courseId}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            await loadCart(); // Reload cart after removing item
        }
    } catch (error) {
        console.error('Error removing from cart:', error);
    }
}

// Update cart count in navbar
function updateCartCount() {
    const cartCount = document.querySelector('.cart-count');
    if (cartCount) {
        cartCount.textContent = cart.length;
    }
}

// Checkout function
function checkout() {
    if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
    }
    alert('Thank you for your purchase! This is a demo, so no actual payment will be processed.');
    cart = [];
    updateCartCount();
    const cartModal = bootstrap.Modal.getInstance(document.getElementById('cartModal'));
    cartModal.hide();
}

// Initialize cart when page loads
document.addEventListener('DOMContentLoaded', () => {
    loadCart();
    
    // Setup cart button click handler
    const cartBtn = document.querySelector('.cart-btn');
    if (cartBtn) {
        cartBtn.addEventListener('click', () => {
            displayCart();
            const cartModal = new bootstrap.Modal(document.getElementById('cartModal'));
            cartModal.show();
        });
    }
});
</script>

<!-- Add Cart Modal -->
<div class="modal fade" id="cartModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Shopping Cart</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="cartItems">
          <!-- Cart items will be dynamically loaded here -->
        </div>
        <div class="text-end mt-3">
          <h5>Total: £<span id="cartTotal">0.00</span></h5>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="checkout()">Proceed to Checkout</button>
      </div>
    </div>
  </div>
</div>
</body>
</html>
